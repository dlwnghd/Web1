/*HR 계정의 DEPT 테이블을 새로 만든 계정으로 복사, 복사한 테이블에서 LOC별 평균 급여 검색*/
/*
 * SQL> conn hr/hr
 * SQL> grant select on dept to baby;
 * SQL> grant select on emp to baby;
 * */
CREATE TABLE COPY_DEPT AS SELECT * FROM HR.DEPT;
SELECT * FROM COPY_DEPT;

CREATE TABLE SALARY_OF_LOCATION AS 
(SELECT LOC, ROUND(AVG(SAL), 2) "AVG"
FROM COPY_DEPT D JOIN HR.EMP E
ON D.DEPTNO = E.DEPTNO
GROUP BY LOC);

SELECT * FROM SALARY_OF_LOCATION;

/*VIEW, 조회한 결과 테이블은 ORDER BY를 작성해서는 안된다.*/
/*PLAYER 테이블에서 나이 컬럼 추가한 뷰 만들기*/
SELECT * FROM PLAYER;
SELECT TRUNC((SYSDATE - BIRTH_DATE) / 365) FROM PLAYER;

CREATE VIEW VIEW_PLAYER
AS
(SELECT TRUNC((SYSDATE - BIRTH_DATE) / 365) AGE, PLAYER.* FROM PLAYER);

SELECT * FROM VIEW_PLAYER;

SELECT * FROM VIEW_PLAYER
WHERE AGE < 30;

/*EMPLOYEES 테이블에서 사원 이름과 그 사원의 매니저 이름이 있는 VIEW 만들기*/
/*FIRST_NAME과 LAST_NAME은 CONCATENATION을 사용하여 연결해준다.*/
CREATE VIEW VIEW_EMPLOYEES AS
(
   SELECT 
      E1.FIRST_NAME || ' ' || E1.LAST_NAME EMPLOYEE_NAME,
      E2.FIRST_NAME || ' ' || E2.LAST_NAME MANAGER_NAME,
      J.JOB_TITLE
   FROM EMPLOYEES E1, EMPLOYEES E2, JOBS J 
   WHERE E1.MANAGER_ID = E2.EMPLOYEE_ID AND E2.JOB_ID = J.JOB_ID
);

SELECT * FROM VIEW_EMPLOYEES
ORDER BY MANAGER_NAME;

















